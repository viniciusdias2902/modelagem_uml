@startuml

' ==========================================
' INTERFACES
' ==========================================

package "Interfaces" {
    interface Usuario <<interface>> {
        +getNome(): String
        +getEmail(): String
        +getSenha(): String
    }

    interface Subject <<interface>> {
        +attach(observer: Observer)
        +detach(observer: Observer)
        +notify(evento: Object)
    }

    interface Observer <<interface>> {
        +update(evento: Object)
    }

    interface GeradorComprovante <<interface>> {
        +gerar(pagamento: Pagamento): Arquivo
    }
}

' ==========================================
' ENUMS
' ==========================================

package "Enumerations" {
    enum StatusRota {
        NAO_INICIADA
        EM_ANDAMENTO
        FINALIZADA
    }

    enum StatusSolicitacao {
        PENDENTE
        APROVADA
        REJEITADA
    }

    enum TipoEventoRota {
        ROTA_INICIADA
    }

    enum TipoEventoSolicitacao {
        SOLICITACAO_CRIADA
        SOLICITACAO_APROVADA
        SOLICITACAO_REJEITADA
    }
}

' ==========================================
' FACTORY PATTERN
' ==========================================

package "Factory Pattern" {
    class UsuarioFactory {
        +criarUsuario(dados: DadosUsuario): Usuario
    }

    class DadosUsuario <<dto>> {
        +nome: String
        +email: String
        +senha: String
        +cnh: String
        +pontoEmbarque: PontoEmbarque
    }
}

' ==========================================
' OBSERVER PATTERN
' ==========================================

package "Observer Pattern" {
    class EventoRota {
        -tipo: TipoEventoRota
        -rota: Rota
        -timestamp: DateTime
        +getTipo(): TipoEventoRota
        +getRota(): Rota
    }

    class EventoPosicao {
        -rota: Rota
        -pontoAtual: PontoEmbarque
        -timestamp: DateTime
        +getRota(): Rota
        +getPontoAtual(): PontoEmbarque
    }

    class EventoSolicitacao {
        -tipo: TipoEventoSolicitacao
        -solicitacao: Solicitacao
        +getTipo(): TipoEventoSolicitacao
        +getSolicitacao(): Solicitacao
    }

    class NotificacaoAlunoObserver {
        +update(evento: Object)
    }

    class NotificacaoMotoristaObserver {
        +update(evento: Object)
    }
}

' ==========================================
' STRATEGY PATTERN
' ==========================================

package "Strategy Pattern" {
    class GeradorPDF {
        +gerar(pagamento: Pagamento): Arquivo
    }

    class GeradorWord {
        +gerar(pagamento: Pagamento): Arquivo
    }

    class GeradorPlanilha {
        +criar(dados: List): Arquivo
        +adicionarCabecalho()
        +adicionarLinhas(registros: List)
    }
}

' ==========================================
' ENTITIES
' ==========================================

package "Entities" {

    package "Usuários" {
        class Administrador <<entity>> {
            -id: UUID
            -nome: String
            -email: String
            -senha: String
            +getNome(): String
            +getEmail(): String
        }

        class Aluno <<entity>> {
            -id: UUID
            -nome: String
            -email: String
            -senha: String
            -pontoEmbarque: PontoEmbarque
            +getNome(): String
            +getEmail(): String
            +getSenha(): String
            +getPontoEmbarque(): PontoEmbarque
            +setPontoEmbarque(ponto: PontoEmbarque)
            +getRegistroFinanceiro(): RegistroFinanceiro
            +getRota(): Rota
        }

        class Motorista <<entity>> {
            -id: UUID
            -nome: String
            -email: String
            -senha: String
            -cnh: String
            +getNome(): String
            +getEmail(): String
            +getSenha(): String
        }

        class Secretaria <<entity>> {
            -id: UUID
            -nome: String
            -email: String
            -senha: String
            +getNome(): String
            +getEmail(): String
            +getSenha(): String
        }

        class Sessao <<entity>> {
            -id: UUID
            -dataLogin: DateTime
            -ativa: Boolean
            +getDataLogin(): DateTime
            +isAtiva(): Boolean
        }
    }

    package "Rota e Transporte" {
        class Rota <<entity>> {
            -id: UUID
            -nome: String
            -data: Date
            -status: StatusRota
            -horaInicio: DateTime
            -pontoAtual: PontoEmbarque
            -pontos: List<PontoEmbarque>
            +iniciar()
            +getStatus(): StatusRota
            +getPontoAtual(): PontoEmbarque
            +setPontoAtual(ponto: PontoEmbarque)
            +getPontos(): List<PontoEmbarque>
            +getAlunos(): List<Aluno>
            +adicionarPonto(ponto: PontoEmbarque)
            +reordenarPontos()
            +calcularProximoPonto(): PontoEmbarque
        }

        class PontoEmbarque <<entity>> {
            -id: UUID
            -nome: String
            -endereco: String
            -referencia: String
            -ordem: Integer
            +getNome(): String
            +getEndereco(): String
            +getReferencia(): String
            +getOrdem(): Integer
            +setOrdem(ordem: Integer)
        }
    }

    package "Enquete" {
        class Enquete <<entity>> {
            -id: UUID
            -data: Date
            -ativa: Boolean
            +getData(): Date
            +isAtiva(): Boolean
        }

        class RespostaEnquete <<entity>> {
            -id: UUID
            -data: Date
            -opcaoTrajeto: String
            +getData(): Date
            +getOpcaoTrajeto(): String
        }
    }

    package "Financeiro" {
        class RegistroFinanceiro <<entity>> {
            -id: UUID
            -valorPago: Decimal
            -valorDevido: Decimal
            -status: String
            +getValorPago(): Decimal
            +getValorDevido(): Decimal
            +getStatus(): String
            +adicionarPagamento(pagamento: Pagamento)
            +calcularSaldo(): Decimal
            +atualizarStatus()
        }

        class Pagamento <<entity>> {
            -id: UUID
            -valor: Decimal
            -data: Date
            -status: String
            +getValor(): Decimal
            +getData(): Date
            +getStatus(): String
            +getAluno(): Aluno
        }

        class Comprovante <<entity>> {
            -id: UUID
            -dataEmissao: DateTime
            -formato: String
            +getConteudo(): Arquivo
        }
    }

    package "Solicitação" {
        class Solicitacao <<entity>> {
            -id: UUID
            -pontoAtual: PontoEmbarque
            -pontoDesejado: PontoEmbarque
            -justificativa: String
            -status: StatusSolicitacao
            -dataCriacao: DateTime
            -dataDecisao: DateTime
            -motivoRejeicao: String
            +aprovar()
            +rejeitar(motivo: String)
            +getAluno(): Aluno
            +getPontoDesejado(): PontoEmbarque
            +getStatus(): StatusSolicitacao
        }
    }
}

' ==========================================
' BOUNDARIES
' ==========================================

package "Boundaries" {
    class TelaCadastro <<boundary>> {
        +exibirFormulario()
        +obterDados(): DadosUsuario
        +exibirMensagemSucesso()
        +exibirMensagemErro(msg: String)
    }

    class TelaAutoCadastro <<boundary>> {
        +exibirFormulario()
        +obterDados(): DadosUsuario
        +exibirMensagemSucesso()
        +exibirMensagemErro(msg: String)
    }

    class TelaLogin <<boundary>> {
        +exibirFormulario()
        +obterCredenciais()
        +redirecionarTelaInicial(perfil: String)
        +exibirMensagemErro()
    }

    class TelaEnquete <<boundary>> {
        +exibirEnquete()
        +obterDataSelecionada(): Date
        +obterOpcaoTrajeto(): String
        +exibirConfirmacao()
    }

    class TelaControleRota <<boundary>> {
        +exibirRota(rota: Rota)
        +exibirBotaoIniciar()
        +exibirListaPontos(pontos: List)
        +exibirPontoAtual(ponto: PontoEmbarque)
        +exibirProximoPonto(ponto: PontoEmbarque)
        +exibirConfirmacao(msg: String)
        +exibirErro(msg: String)
    }

    class TelaVisualizacaoRota <<boundary>> {
        +exibirRota()
        +exibirListaPontos()
        +destacarPontoAluno()
    }

    class TelaFinanceira <<boundary>> {
        +exibirTabelaFinanceira()
        +exibirListaAlunos()
        +exibirPagamentos(aluno: Aluno)
        +obterFormatoEscolhido(): String
        +obterPeriodo()
        +disponibilizarDownload(arquivo: Arquivo)
        +exibirConfirmacao()
    }

    class TelaGestaoPontos <<boundary>> {
        +exibirFormulario()
        +obterNome(): String
        +obterReferencia(): String
        +obterOrdem(): Integer
        +exibirConfirmacao()
    }

    class TelaSolicitarTroca <<boundary>> {
        +exibirPontosDisponiveis(pontos: List)
        +obterPontoSelecionado(): PontoEmbarque
        +obterJustificativa(): String
        +exibirConfirmacao(msg: String)
        +exibirErro(msg: String)
    }

    class TelaAnaliseSolicitacao <<boundary>> {
        +exibirListaSolicitacoes(lista: List)
        +exibirDetalhesSolicitacao(s: Solicitacao)
        +obterDecisao(): String
        +obterMotivoRejeicao(): String
        +exibirConfirmacao(msg: String)
    }

    class ServicoNotificacao <<boundary>> {
        +enviarNotificacao(destinatario: String, titulo: String, mensagem: String)
    }
}

' ==========================================
' CONTROLLERS
' ==========================================

package "Controllers" {
    class CadastroController <<controller>> {
        +cadastrarUsuario(dados: DadosUsuario)
        -validarDados(dados: DadosUsuario): Boolean
    }

    class AutoCadastroController <<controller>> {
        +realizarCadastro(dados: DadosUsuario)
        -validarDados(dados: DadosUsuario): Boolean
    }

    class AutenticacaoController <<controller>> {
        +autenticar(email: String, senha: String): Usuario
        -validarCredenciais(email: String, senha: String): Boolean
        +criarSessao(usuario: Usuario): Sessao
    }

    class EnqueteController <<controller>> {
        +carregarEnquete(data: Date): Enquete
        +registrarResposta(aluno: Aluno, data: Date, opcao: String)
        +atualizarListaEmbarque()
    }

    class IniciarRotaController <<controller>> {
        -observers: List<Observer>
        +attach(observer: Observer)
        +detach(observer: Observer)
        +notify(evento: EventoRota)
        +carregarRota(data: Date): Rota
        +iniciarRota(rota: Rota)
    }

    class PontoAtualController <<controller>> {
        -observers: List<Observer>
        +attach(observer: Observer)
        +detach(observer: Observer)
        +notify(evento: EventoPosicao)
        +carregarPontosRota(rota: Rota): List
        +atualizarPontoAtual(rota: Rota, ponto: PontoEmbarque)
    }

    class ProximoPontoController <<controller>> {
        +consultarProximoPonto(rota: Rota): PontoEmbarque
    }

    class VisualizacaoRotaController <<controller>> {
        +carregarRota(): Rota
        +carregarPontos(): List
        +identificarPontoAluno(aluno: Aluno): PontoEmbarque
    }

    class FinanceiroController <<controller>> {
        +carregarDadosFinanceiros(): List
        +filtrarPagamentosRealizados(): List
        +filtrarPagamentosPendentes(): List
    }

    class PagamentoController <<controller>> {
        +carregarAlunos(): List
        +registrarPagamento(aluno: Aluno, valor: Decimal, data: Date)
        +atualizarSaldo(aluno: Aluno)
    }

    class ComprovanteController <<controller>> {
        +carregarPagamentos(aluno: Aluno): List
        +gerarComprovante(pagamento: Pagamento, formato: String): Arquivo
        -obterGeradorFormato(formato: String): GeradorComprovante
    }

    class ExportacaoController <<controller>> {
        +carregarDadosPeriodo(dataInicio: Date, dataFim: Date): List
        +exportar(): Arquivo
        -gerarPlanilha(dados: List): Arquivo
    }

    class PontoEmbarqueController <<controller>> {
        +cadastrarPonto(nome: String, referencia: String, ordem: Integer)
        -validarDados(nome: String, referencia: String, ordem: Integer): Boolean
        +atualizarOrdemRota()
    }

    class SolicitacaoController <<controller>> {
        -observers: List<Observer>
        +attach(observer: Observer)
        +detach(observer: Observer)
        +notify(evento: EventoSolicitacao)
        +carregarPontosDisponiveis(rota: Rota): List
        +criarSolicitacao(aluno: Aluno, novoPonto: PontoEmbarque, justificativa: String): Solicitacao
        -validarSolicitacao(aluno: Aluno, novoPonto: PontoEmbarque): Boolean
    }

    class AnaliseSolicitacaoController <<controller>> {
        -observers: List<Observer>
        +attach(observer: Observer)
        +detach(observer: Observer)
        +notify(evento: EventoSolicitacao)
        +carregarSolicitacoesPendentes(): List
        +aprovarSolicitacao(solicitacao: Solicitacao)
        +rejeitarSolicitacao(solicitacao: Solicitacao, motivo: String)
    }
}

' ==========================================
' RELACIONAMENTOS - HERANÇA E INTERFACES
' ==========================================

Usuario <|.. Aluno
Usuario <|.. Motorista
Usuario <|.. Secretaria

Subject <|.. IniciarRotaController
Subject <|.. PontoAtualController
Subject <|.. SolicitacaoController
Subject <|.. AnaliseSolicitacaoController

Observer <|.. NotificacaoAlunoObserver
Observer <|.. NotificacaoMotoristaObserver

GeradorComprovante <|.. GeradorPDF
GeradorComprovante <|.. GeradorWord

' ==========================================
' RELACIONAMENTOS - ENTIDADES
' ==========================================

Aluno --> PontoEmbarque : pontoEmbarque
Aluno --> RegistroFinanceiro
Aluno --> Rota

Rota --> StatusRota
Rota --> "0..*" PontoEmbarque : pontos
Rota --> PontoEmbarque : pontoAtual
Rota --> "0..*" Aluno

RegistroFinanceiro --> "0..*" Pagamento
RegistroFinanceiro --> Aluno

Pagamento --> Aluno

RespostaEnquete --> Aluno

Solicitacao --> Aluno
Solicitacao --> "2" PontoEmbarque
Solicitacao --> StatusSolicitacao

Sessao --> Usuario

' ==========================================
' RELACIONAMENTOS - EVENTOS
' ==========================================

EventoRota --> TipoEventoRota
EventoRota --> Rota

EventoPosicao --> Rota
EventoPosicao --> PontoEmbarque

EventoSolicitacao --> TipoEventoSolicitacao
EventoSolicitacao --> Solicitacao

' ==========================================
' RELACIONAMENTOS - BOUNDARIES E CONTROLLERS
' ==========================================

TelaCadastro --> CadastroController
TelaAutoCadastro --> AutoCadastroController
TelaLogin --> AutenticacaoController
TelaEnquete --> EnqueteController
TelaControleRota --> IniciarRotaController
TelaControleRota --> PontoAtualController
TelaControleRota --> ProximoPontoController
TelaVisualizacaoRota --> VisualizacaoRotaController
TelaFinanceira --> FinanceiroController
TelaFinanceira --> PagamentoController
TelaFinanceira --> ComprovanteController
TelaFinanceira --> ExportacaoController
TelaGestaoPontos --> PontoEmbarqueController
TelaSolicitarTroca --> SolicitacaoController
TelaAnaliseSolicitacao --> AnaliseSolicitacaoController

' ==========================================
' RELACIONAMENTOS - CONTROLLERS E ENTIDADES
' ==========================================

CadastroController --> UsuarioFactory
UsuarioFactory ..> Usuario : <<creates>>

AutoCadastroController ..> Aluno : <<creates>>

AutenticacaoController --> Usuario
AutenticacaoController --> Sessao

EnqueteController --> Enquete
EnqueteController --> RespostaEnquete
EnqueteController --> Aluno

IniciarRotaController o--> "0..*" Observer : observers
IniciarRotaController --> Rota

PontoAtualController o--> "0..*" Observer : observers
PontoAtualController --> Rota
PontoAtualController --> PontoEmbarque

ProximoPontoController --> Rota

VisualizacaoRotaController --> Rota
VisualizacaoRotaController --> Aluno

FinanceiroController --> RegistroFinanceiro
FinanceiroController --> Pagamento

PagamentoController --> Aluno
PagamentoController --> Pagamento
PagamentoController --> RegistroFinanceiro

ComprovanteController --> GeradorComprovante
ComprovanteController --> Pagamento
ComprovanteController --> Comprovante

ExportacaoController --> GeradorPlanilha
ExportacaoController --> RegistroFinanceiro

PontoEmbarqueController --> PontoEmbarque
PontoEmbarqueController --> Rota

SolicitacaoController o--> "0..*" Observer : observers
SolicitacaoController --> Aluno
SolicitacaoController --> PontoEmbarque
SolicitacaoController ..> Solicitacao : <<creates>>

AnaliseSolicitacaoController o--> "0..*" Observer : observers
AnaliseSolicitacaoController --> Solicitacao
AnaliseSolicitacaoController --> Aluno

' ==========================================
' RELACIONAMENTOS - OBSERVERS
' ==========================================

NotificacaoAlunoObserver --> ServicoNotificacao
NotificacaoAlunoObserver --> Aluno

NotificacaoMotoristaObserver --> ServicoNotificacao
NotificacaoMotoristaObserver --> Motorista

' ==========================================
' RELACIONAMENTOS - GERADORES
' ==========================================

GeradorPDF --> Comprovante
GeradorWord --> Comprovante

@enduml