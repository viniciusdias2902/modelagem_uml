@startuml

title Diagrama Geral de Classes - Sistema Unibus (Arquitetura BCE Completa)

skinparam classAttributeIconSize 0
skinparam packageStyle rectangle

' ============================================
' CAMADA BOUNDARY - INTERFACES
' ============================================
package "Boundary" <<Frame>> {

    class TelaCadastro <<boundary>> {
        +exibirFormulario()
        +obterDados()
        +exibirMensagemSucesso()
        +exibirMensagemErro()
    }

    class TelaLogin <<boundary>> {
        +exibirFormulario()
        +obterCredenciais()
        +redirecionarTelaInicial(perfil)
        +exibirMensagemErro()
    }

    class TelaEnquete <<boundary>> {
        +exibirEnquete()
        +obterDataSelecionada()
        +obterOpcaoTrajeto()
        +exibirConfirmacao()
    }

    class TelaControleRota <<boundary>> {
        +exibirRota()
        +exibirBotaoIniciar()
        +exibirListaPontos()
        +obterPontoSelecionado()
        +exibirPontoAtual()
        +exibirProximoPonto()
        +exibirConfirmacao()
    }

    class TelaVisualizacaoRota <<boundary>> {
        +exibirRota()
        +exibirListaPontos()
        +destacarPontoAluno()
    }

    class TelaFinanceira <<boundary>> {
        +exibirTabelaFinanceira()
        +exibirListaAlunos()
        +exibirPagamentos(aluno)
        +exibirPagamentosRealizados()
        +exibirPagamentosPendentes()
        +obterAlunoSelecionado()
        +obterValorPagamento()
        +obterDataPagamento()
        +obterFormatoEscolhido()
        +obterPeriodo()
        +disponibilizarDownload(arquivo)
        +exibirConfirmacao()
    }

    class TelaGestaoPontos <<boundary>> {
        +exibirFormulario()
        +obterNome()
        +obterReferencia()
        +obterOrdem()
        +exibirConfirmacao()
    }

    class TelaSolicitacoes <<boundary>> {
        +exibirPontosDisponiveis()
        +obterPontoSelecionado()
        +obterJustificativa()
        +exibirConfirmacao()
    }

    class TelaAnaliseSolicitacao <<boundary>> {
        +exibirListaSolicitacoes()
        +exibirDetalhesSolicitacao()
        +obterDecisao()
    }

    class ServicoNotificacao <<boundary>> {
        +enviarNotificacao(destinatario, mensagem)
        +notificar(destinatario, mensagem)
    }
}

' ============================================
' CAMADA CONTROLLER - LÓGICA DE APLICAÇÃO
' ============================================
package "Controller" <<Frame>> {

    class CadastroController <<controller>> {
        +cadastrarUsuario(dados)
        +validarDados(dados)
    }

    class UsuarioFactory <<controller>> {
        +criarUsuario(tipo, dados): Usuario
    }

    class AutenticacaoController <<controller>> {
        +autenticar(email, senha)
        +validarCredenciais(email, senha)
        +criarSessao(usuario)
    }

    class EnqueteController <<controller>> {
        +carregarEnquete(data)
        +registrarResposta(aluno, data, opcao)
        +atualizarListaEmbarque()
    }

    class RotaController <<controller>> {
        +carregarRota(data)
        +iniciarRota()
        +notificarAlunos()
    }

    class PontoController <<controller>> {
        +carregarPontosRota()
        +atualizarPontoAtual(ponto)
        +calcularProximoPonto()
        +disponibilizarPosicao()
    }

    class VisualizacaoRotaController <<controller>> {
        +carregarRota()
        +carregarPontos()
        +identificarPontoAluno(aluno)
    }

    class FinanceiroController <<controller>> {
        +carregarDadosFinanceiros()
        +filtrarPagamentosRealizados()
        +filtrarPagamentosPendentes()
    }

    class PagamentoController <<controller>> {
        +carregarAlunos()
        +registrarPagamento(aluno, valor, data)
        +atualizarSaldo(aluno)
    }

    class ComprovanteController <<controller>> {
        +carregarPagamentos(aluno)
        +gerarComprovante(pagamento, formato)
        +obterGeradorFormato(formato)
    }

    class ExportacaoController <<controller>> {
        +carregarDadosPeriodo(dataInicio, dataFim)
        +gerarPlanilha(dados)
        +exportar()
    }

    class GeradorPlanilha <<controller>> {
        +criar(dados): Arquivo
        +adicionarCabecalho()
        +adicionarLinhas(registros)
    }

    class PontoEmbarqueController <<controller>> {
        +validarDados(nome, referencia, ordem)
        +cadastrarPonto(nome, referencia, ordem)
        +atualizarOrdemRota()
    }

    class SolicitacaoController <<controller>> {
        +carregarPontosDisponiveis()
        +criarSolicitacao(aluno, novoPonto, justificativa)
        +notificarMotorista(solicitacao)
        +carregarSolicitacoesPendentes()
        +processarDecisao(solicitacao, decisao)
        +notificarAluno(solicitacao, decisao)
    }

    interface GeradorComprovante <<controller>> {
        +gerar(pagamento): Comprovante
    }

    class GeradorPDF <<controller>> {
        +gerar(pagamento): Comprovante
    }

    class GeradorWord <<controller>> {
        +gerar(pagamento): Comprovante
    }
}

' ============================================
' CAMADA ENTITY - DOMÍNIO
' ============================================
package "Entity" <<Frame>> {

    abstract class Usuario <<entity>> {
        -id: Integer
        -nome: String
        -email: String
        -senha: String
        +getNome(): String
        +getEmail(): String
        +getSenha(): String
        +autenticar(senha): Boolean
    }

    class Administrador <<entity>> {
        +cadastrarUsuario(dados)
        +cadastrarPontoEmbarque(dados)
    }

    class Aluno <<entity>> {
        -dispositivo: String
        +getPontoEmbarque(): PontoEmbarque
        +setPontoEmbarque(ponto)
        +getRegistroFinanceiro(): RegistroFinanceiro
        +receberNotificacao(mensagem)
        +receberAtualizacao(pontoAtual)
    }

    class Motorista <<entity>> {
        +receberNotificacao(mensagem)
    }

    class Secretaria <<entity>> {
    }

    class Sessao <<entity>> {
        -dataLogin: DateTime
        -ativa: Boolean
        +getUsuario(): Usuario
        +getDataLogin(): DateTime
        +isAtiva(): Boolean
        +encerrar()
    }

    class Rota <<entity>> {
        -data: Date
        -status: String
        -horaInicio: DateTime
        +iniciar()
        +finalizar()
        +getStatus(): String
        +getPontos(): List
        +getAlunos(): List
        +getPontoAtual(): PontoEmbarque
        +getProximoPonto(): PontoEmbarque
        +setPontoAtual(ponto)
    }

    class PontoEmbarque <<entity>> {
        -nome: String
        -referencia: String
        -ordem: Integer
        +getNome(): String
        +getReferencia(): String
        +getOrdem(): Integer
        +setOrdem(ordem)
    }

    class Enquete <<entity>> {
        -data: Date
        -ativa: Boolean
        +getData(): Date
        +isAtiva(): Boolean
        +getRespostas(): List
    }

    class RespostaEnquete <<entity>> {
        -data: Date
        -opcaoTrajeto: String
        +getData(): Date
        +getOpcaoTrajeto(): String
        +getAluno(): Aluno
    }

    class RegistroFinanceiro <<entity>> {
        -valorPago: Decimal
        -valorDevido: Decimal
        -status: String
        +getValorPago(): Decimal
        +getValorDevido(): Decimal
        +getStatus(): String
        +calcularSaldo(): Decimal
        +adicionarPagamento(pagamento)
        +atualizarStatus()
    }

    class Pagamento <<entity>> {
        -valor: Decimal
        -data: Date
        -status: String
        +getValor(): Decimal
        +getData(): Date
        +getStatus(): String
        +getAluno(): Aluno
    }

    class Comprovante <<entity>> {
        -dataEmissao: DateTime
        -formato: String
        +getConteudo(): String
        +getPagamento(): Pagamento
    }

    class Solicitacao <<entity>> {
        -justificativa: String
        -status: String
        -dataSolicitacao: DateTime
        +getStatus(): String
        +getJustificativa(): String
        +getPontoAtual(): PontoEmbarque
        +getPontoDesejado(): PontoEmbarque
        +aprovar()
        +rejeitar()
    }
}

' ============================================
' RELACIONAMENTOS BOUNDARY -> CONTROLLER
' ============================================
TelaCadastro --> CadastroController
TelaLogin --> AutenticacaoController
TelaEnquete --> EnqueteController
TelaControleRota --> RotaController
TelaControleRota --> PontoController
TelaVisualizacaoRota --> VisualizacaoRotaController
TelaFinanceira --> FinanceiroController
TelaFinanceira --> PagamentoController
TelaFinanceira --> ComprovanteController
TelaFinanceira --> ExportacaoController
TelaGestaoPontos --> PontoEmbarqueController
TelaSolicitacoes --> SolicitacaoController
TelaAnaliseSolicitacao --> SolicitacaoController

' ============================================
' RELACIONAMENTOS CONTROLLER -> CONTROLLER
' ============================================
CadastroController --> UsuarioFactory
ComprovanteController --> GeradorComprovante
ExportacaoController --> GeradorPlanilha
RotaController --> ServicoNotificacao
SolicitacaoController --> ServicoNotificacao
GeradorComprovante <|.. GeradorPDF
GeradorComprovante <|.. GeradorWord

' ============================================
' RELACIONAMENTOS CONTROLLER -> ENTITY
' ============================================
UsuarioFactory ..> Usuario : <<creates>>
AutenticacaoController --> Usuario
AutenticacaoController --> Sessao
EnqueteController --> Enquete
EnqueteController --> RespostaEnquete
EnqueteController --> Aluno
RotaController --> Rota
RotaController --> Motorista
PontoController --> Rota
PontoController --> PontoEmbarque
PontoController --> Aluno
VisualizacaoRotaController --> Rota
VisualizacaoRotaController --> PontoEmbarque
VisualizacaoRotaController --> Aluno
FinanceiroController --> RegistroFinanceiro
FinanceiroController --> Aluno
FinanceiroController --> Pagamento
PagamentoController --> Aluno
PagamentoController --> Pagamento
PagamentoController --> RegistroFinanceiro
ComprovanteController --> Pagamento
ComprovanteController --> Aluno
ExportacaoController --> RegistroFinanceiro
ExportacaoController --> Aluno
PontoEmbarqueController --> PontoEmbarque
PontoEmbarqueController --> Rota
SolicitacaoController --> Solicitacao
SolicitacaoController --> Aluno
SolicitacaoController --> Motorista
SolicitacaoController --> PontoEmbarque
GeradorPDF ..> Comprovante : <<creates>>
GeradorWord ..> Comprovante : <<creates>>

' ============================================
' RELACIONAMENTOS ENTITY - GENERALIZAÇÃO
' ============================================
Usuario <|-- Administrador
Usuario <|-- Aluno
Usuario <|-- Motorista
Usuario <|-- Secretaria

' ============================================
' RELACIONAMENTOS ENTITY - COMPOSIÇÃO
' ============================================
Rota "1" *-- "2..*" PontoEmbarque
Enquete "1" *-- "0..*" RespostaEnquete
Aluno "1" *-- "1" RegistroFinanceiro
RegistroFinanceiro "1" *-- "0..*" Pagamento

' ============================================
' RELACIONAMENTOS ENTITY - AGREGAÇÃO
' ============================================
Rota "0..*" o-- "0..*" Aluno : inscritos

' ============================================
' RELACIONAMENTOS ENTITY - ASSOCIAÇÃO
' ============================================
Sessao "0..*" -- "1" Usuario
Aluno "0..*" -- "1" PontoEmbarque : embarca em
Aluno "1" -- "0..*" RespostaEnquete : responde
Aluno "1" -- "0..*" Solicitacao : solicita
Pagamento "1" -- "0..1" Comprovante : gera
Solicitacao "0..*" -- "1" PontoEmbarque : ponto atual
Solicitacao "0..*" -- "1" PontoEmbarque : ponto desejado
Motorista "1" -- "0..*" Solicitacao : analisa
ServicoNotificacao --> Aluno
ServicoNotificacao --> Motorista

@enduml
