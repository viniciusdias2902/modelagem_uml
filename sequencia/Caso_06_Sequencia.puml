@startuml

actor Motorista
participant ":TelaControleRota" as TCR <<boundary>>
participant ":PontoAtualController" as PAC <<controller>>
participant ":RotaRepository" as RR <<repository>>
participant ":Rota" as R <<entity>>
participant ":Observer" as OBS <<interface>>

== Carregar Pontos da Rota ==

Motorista -> TCR: acessarTela()
activate TCR

TCR -> PAC: carregarPontosRota(rota)
activate PAC

PAC -> RR: findById(rotaId)
activate RR
RR --> PAC: rota
deactivate RR

PAC -> R: getPontos()
activate R
R --> PAC: listaPontos
deactivate R

PAC --> TCR: listaPontos
deactivate PAC

TCR -> TCR: exibirListaPontos(listaPontos)
TCR --> Motorista: tela com pontos da rota

== Atualizar Ponto Atual ==

Motorista -> TCR: selecionarPonto(ponto)
TCR -> TCR: obterPontoSelecionado()

TCR -> PAC: atualizarPontoAtual(rota, ponto)
activate PAC

PAC -> R: setPontoAtual(ponto)
activate R
R --> PAC: void
deactivate R

PAC -> RR: save(rota)

== Padrão Observer: Notificar Alunos ==

PAC -> PAC: notify(new EventoPosicao(rota, ponto))

group Observer Pattern
    loop para cada observer registrado
        PAC -> OBS: update(evento)
        activate OBS
        note right
          NotificacaoAlunoObserver:
          1. Obtém alunos da rota
          2. Envia notificação para cada
             aluno via ServicoNotificacao
        end note
        OBS --> PAC: void
        deactivate OBS
    end
end

PAC --> TCR: sucesso
deactivate PAC


TCR -> TCR: exibirPontoAtual(ponto)
TCR -> TCR: exibirConfirmacao("Ponto atualizado!")
TCR --> Motorista: confirmação
deactivate TCR

@enduml
