@startuml

actor Motorista
participant ":TelaControleRota" as TCR <<boundary>>
participant ":ProximoPontoController" as PPC <<controller>>
participant ":RotaRepository" as RR <<repository>>
participant ":Rota" as R <<entity>>

== Consultar Próximo Ponto ==

Motorista -> TCR: acessarTela()
activate TCR

TCR -> PPC: consultarProximoPonto(rota)
activate PPC

PPC -> RR: findById(rotaId)
activate RR
RR --> PPC: rota
deactivate RR

PPC -> R: getPontoAtual()
activate R
R --> PPC: pontoAtual
deactivate R


alt pontoAtual == null
    PPC --> TCR: erro("Ponto atual não definido")
    TCR -> TCR: exibirErro("Atualize o ponto atual primeiro")
else pontoAtual definido
    PPC -> R: calcularProximoPonto()
    activate R
    note right
      Information Expert:
      Rota conhece seus pontos
      e calcula o próximo
      baseado na ordem
    end note
    R --> PPC: proximoPonto
    deactivate R
    
    alt proximoPonto == null
        PPC --> TCR: null
        TCR -> TCR: exibirMensagemUltimoPonto()
        TCR --> Motorista: "Este é o último ponto da rota"
    else proximoPonto existe
        PPC --> TCR: proximoPonto
        deactivate PPC
        TCR -> TCR: exibirPontoAtual(pontoAtual)
        TCR -> TCR: exibirProximoPonto(proximoPonto)
        TCR --> Motorista: tela com pontos atual e próximo
    end
end

deactivate TCR

@enduml
