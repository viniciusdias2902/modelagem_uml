@startuml

actor Motorista
participant ":TelaControleRota" as TCR <<boundary>>
participant ":IniciarRotaController" as IRC <<controller>>
participant ":RotaRepository" as RR <<repository>>
participant ":Rota" as R <<entity>>
participant ":Observer" as OBS <<interface>>

== Carregar Rota ==

Motorista -> TCR: acessarTela()
activate TCR

TCR -> IRC: carregarRota(data)
activate IRC

IRC -> RR: findByData(data)
activate RR
RR --> IRC: rota
deactivate RR

IRC --> TCR: rota
deactivate IRC

TCR -> TCR: exibirRota(rota)
TCR -> TCR: exibirBotaoIniciar()
TCR --> Motorista: tela com rota

== Iniciar Rota ==

Motorista -> TCR: clicarIniciarRota()

TCR -> IRC: iniciarRota(rota)
activate IRC

IRC -> R: getStatus()
activate R
R --> IRC: NAO_INICIADA
deactivate R

IRC -> R: iniciar()
activate R
note right
  Information Expert:
  Rota.iniciar() atualiza
  status e horaInicio
end note
R --> IRC: void
deactivate R

IRC -> RR: save(rota)

== Padrão Observer: Notificar Alunos ==

IRC -> IRC: notify(new EventoRota(ROTA_INICIADA, rota))

group Observer Pattern
    loop para cada observer registrado
        IRC -> OBS: update(evento)
        activate OBS
        note right
          NotificacaoAlunoObserver:
          1. Obtém alunos da rota via evento.getRota().getAlunos()
          2. Para cada aluno, envia notificação
             via ServicoNotificacao (boundary)
        end note
        OBS --> IRC: void
        deactivate OBS
    end
end

IRC --> TCR: sucesso
deactivate IRC

TCR -> TCR: exibirConfirmacao("Rota iniciada com sucesso!")
TCR --> Motorista: confirmação
deactivate TCR

@enduml

' ============================================
' JUSTIFICATIVA DOS PADRÕES NA SEQUÊNCIA
' ============================================
'
' GRASP Controller:
' - IniciarRotaController recebe a requisição da boundary
'   e coordena o fluxo de início da rota.
'
' Observer (GoF):
' - O controller implementa Subject e mantém lista de observers
' - Após iniciar a rota, dispara notify(evento)
' - Cada observer registrado recebe update(evento)
' - NotificacaoAlunoObserver processa o evento:
'   - Extrai a rota do evento
'   - Obtém os alunos da rota
'   - Usa ServicoNotificacao (boundary) para notificar
' - O controller não conhece os observers concretos
'
' Information Expert:
' - Rota.iniciar() gerencia seu próprio estado
' - Rota.getAlunos() fornece lista de alunos
'
' Low Coupling:
' - Controller não conhece como a notificação é feita
' - Observers são registrados/removidos dinamicamente